!function(s){var t={};function o(e){if(t[e])return t[e].exports;var i=t[e]={i:e,l:!1,exports:{}};return s[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=s,o.c=t,o.d=function(s,t,e){o.o(s,t)||Object.defineProperty(s,t,{enumerable:!0,get:e})},o.r=function(s){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},o.t=function(s,t){if(1&t&&(s=o(s)),8&t)return s;if(4&t&&"object"==typeof s&&s&&s.__esModule)return s;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:s}),2&t&&"string"!=typeof s)for(var i in s)o.d(e,i,function(t){return s[t]}.bind(null,i));return e},o.n=function(s){var t=s&&s.__esModule?function(){return s.default}:function(){return s};return o.d(t,"a",t),t},o.o=function(s,t){return Object.prototype.hasOwnProperty.call(s,t)},o.p="",o(o.s=0)}([function(s,t,o){"use strict";o.r(t);class e{constructor(s,t){this.row=s,this.col=t}}const i=$("#game"),c=($("#newgame-btn"),$("#game-button")),l=$("#gamebar"),r=$(".top-border"),n=$(".middle-border"),a=$(".bottom-border"),h=$("#field-container"),d=($("#settings-container"),$("#scores"),".field"),m=".block",u=16,b=10;function f(s,t){!function(s,t){const o=u*s+3*b+32,e=u*t+2*b,r=u*t+2*b,n=u*t/2-13-49,a=u*t/2-13-49;$(i).css("zoom",3),$(i).css({height:o,width:e}),$(l).css("width",r),$(h).css("height",u*s),$(c).css({"margin-left":n,"margin-right":a}),$(c).removeClass("btn-dead"),$(c).removeClass("btn-cool")}(s,t),k(t,r,"t"),function(s,t){for(let o=0;o<s;o++){$(h).append(`<div class="row" id="r${o}"></div>`);const s="#r"+o;$(s).append('<div class="border-vertical"></div>');for(let e=0;e<t;e++){const t=`<div id="${o}-${e}" class="block field"></div>`;$(s).append(t)}$(s).append('<div class="border-vertical"></div>')}}(s,t),k(t,n,"i"),k(t,a,"b")}function k(s,t,o){$(t).append(`<div class="border-${o}l"></div>`);for(let o=1;o<=s;o++)$(t).append('<div class="border-horizontal"></div>');$(t).append(`<div class="border-${o}r"></div>`)}function g(s){const t=[];for(s=Math.abs(s);s>0;)t[t.length]=s%10,s=parseInt(s/10);return t}function p(s,t){return"#"+s+"-"+t}class C{constructor(){this.seconds=0,this.secondsArray=[],this.interval=setInterval(()=>{this.seconds++,999===this.seconds&&this.stopTimer();const s=g(this.seconds);this.timerClass(3,s[0]),this.timerClass(2,s[1]),this.timerClass(1,s[2])},1e3),this.startTs=new Date}timerClass(s,t){t=void 0===t?0:t;const o=`#timer-${s}`;if(parseInt($(o).attr("class").split("d")[2])!==t){for(let s=0;s<=9;s++)$(o).removeClass(`d${s}`);$(o).addClass(`d${t}`)}}setTimerToZero(){this.timerClass(3,0),this.timerClass(2,0),this.timerClass(1,0)}stopTimer(){clearInterval(this.interval)}getFinishTime(){return(new Date-this.startTs)/1e3}}class v{constructor(s){this.points=s;const t=g(this.points);this.scoreClass(3,t[0]),this.scoreClass(2,t[1]),this.scoreClass(1,t[2])}addPoint(){this.points++;const s=g(this.points);this.scoreClass(3,s[0]),this.scoreClass(2,s[1]),this.scoreClass(1,s[2]),this.points<0&&this.scoreClass(1,"-")}removePoint(){this.points--;const s=g(this.points);this.scoreClass(3,s[0]),this.scoreClass(2,s[1]),this.scoreClass(1,s[2]),this.points<0&&this.scoreClass(1,"-")}scoreClass(s,t){t=void 0===t?0:t;const o=`#points-${s}`;$(o).removeClass("d-");for(let s=0;s<=9;s++)$(o).removeClass(`d${s}`);$(o).addClass(`d${t}`)}}const w="b";class y{constructor(s=!1){this.debugLog("Setting up Game"),this.debug=s,this.showBombs=s,this.rows,this.columns,this.bombs,this.setupGame()}setupGame(){$(r).empty(),$(n).empty(),$(h).empty(),$(a).empty();const s=parseInt($("#input-rows").val()),t=parseInt($("#input-columns").val()),o=parseInt($("#input-bombs").val());this.rows=s<8?8:s,this.columns=t<8?8:t,this.bombs=o<1?1:o,this.amountFields=this.rows*this.columns-this.bombs,this.bombsArray=this.createBombs(),this.boardArray=this.createBoardArray(),console.log("boardArray =>",this.boardArray),this.gameWon=!1,f(this.rows,this.columns),this.points=new v(this.bombs),this.timer=new C}createBombs(){const s=[];for(let t=1;t<=this.bombs;t++){let t,o,i=!1;for(;!i;)t=Math.floor(Math.random()*this.rows),o=Math.floor(Math.random()*this.columns),s.some(s=>s.row===t&&s.col===o)||(i=!0);if(s.push(new e(t,o)),this.showBombs){$("#"+t+"-"+o).toggleClass("field bomb")}}return this.debugLog(s),s}createBoardArray(){let s=[];for(let t=0;t<this.rows;t++){s[t]=[];for(let o=0;o<this.columns;o++)s[t][o]=0}for(let t=0;t<this.bombsArray.length;t++){const o=this.bombsArray[t].row,e=this.bombsArray[t].col;s[o][e]=w,s=this.counterUpAround(o,e,s)}return s}counterUpAround(s,t,o){return o=this.counterUp(s+1,t-1,o),o=this.counterUp(s+1,t,o),o=this.counterUp(s+1,t+1,o),o=this.counterUp(s,t-1,o),o=this.counterUp(s,t+1,o),o=this.counterUp(s-1,t-1,o),o=this.counterUp(s-1,t,o),o=this.counterUp(s-1,t+1,o)}counterUp(s,t,o){return s>=0&&s<this.rows&&t>=0&&t<this.columns&&"number"==typeof o[s][t]&&(o[s][t]=o[s][t]+1),o}checkNoBomb(s,t){if(isNaN(s)){throw new Error("Row is NaN")}if(isNaN(t)){throw new Error("Col is NaN")}return this.boardArray[s][t]!==w}blockClicked(s,t,o=""){""===o&&(o=p(s,t)),s<0||s>=this.rows||t<0||t>=this.columns||$(o).hasClass("field")&&(this.checkNoBomb(s,t)?this.fieldClicked(s,t,o):this.bombClicked(s,t,o))}fieldClicked(s,t,o){this.amountFields--;const e=this.boardArray[s][t];$(o).toggleClass(`field f${e} clicked`),$(o).attr("data-value",e),0===e&&this.clickFieldsAround(s,t),0===this.amountFields&&this.winGame()}flagField(s){$(s).hasClass("flag")?(this.points.addPoint(),$(s).removeClass("flag"),$(s).addClass("field")):(this.points.removePoint(),$(s).removeClass("field"),$(s).addClass("flag"))}checkSurroundings(s,t){let o=0;for(let e=-1;e<=1;e++)for(let i=-1;i<=1;i++)this.checkNoBomb(s+e,t+i)||o++;return o}winGame(){if(!this.gameWon){const s=this.timer.getFinishTime();console.log("time =>",s),$(c).toggleClass("btn-smiley btn-cool");for(let s=0;s<this.bombs;s++){const t=p(this.bombsArray[s].row,this.bombsArray[s].col);$(t).hasClass("flag")||this.flagField($(t))}!function(s,t){$(scores).hasClass("hidden")&&($(scores).removeClass("hidden"),$(scores).addClass("visible")),$(scores).find("tbody:last-child").append(`<tr><td>${s}</td><td>${t}</td></tr>`)}(this.rows+"x"+this.columns+", "+this.bombs+" Bombs "+this.seconds,s),this.timer.stopTimer()}this.gameWon=!0}clickFieldsAround(s,t){this.blockClicked(s-1,t-1),this.blockClicked(s-1,t),this.blockClicked(s-1,t+1),this.blockClicked(s+1,t-1),this.blockClicked(s+1,t),this.blockClicked(s+1,t+1),this.blockClicked(s,t-1),this.blockClicked(s,t+1)}bombClicked(s,t,o){$(o).toggleClass("field bomb-red clicked"),this.timer.stopTimer(),$(c).removeClass("btn-smiley"),$(c).addClass("btn-dead");for(let o=0;o<this.bombs;o++)if(this.bombsArray[o].row!==s||this.bombsArray[o].col!==t){const s=p(this.bombsArray[o].row,this.bombsArray[o].col);$(s).toggleClass("field bomb")}const e=this;$(".flag").each(function(){let s=$(this).attr("id");console.log("id =>",s);const t=parseInt(s.split("-")[0]),o=parseInt(s.split("-")[1]);s="#"+s,e.checkNoBomb(t,o)&&$(s).toggleClass("flag no-bomb")});for(let s=1;s<=this.rows;s++)for(let t=1;t<=this.columns;t++){const o=p(s,t);$(o).addClass("clicked")}}debugLog(s){this.debug&&console.log(s)}clearGame(){this.timer.stopTimer(),this.timer.setTimerToZero()}}const A="btn-smiley",B="btn-click",F="btn-wow";let I;class T{constructor(s){I=s,console.log("DOMListener"),this.initDomListener()}initDomListener(){console.log("init"),$(c).mousedown(function(){$(c).removeClass(A),$(c).addClass(B)}),$(game).mouseup(function(){$(c).hasClass(F)?($(c).removeClass(F),$(c).addClass(A)):$(c).hasClass(B)&&($(c).removeClass(B),$(c).addClass(A))}),$(c).click(function(){O()}),$("input:radio").click(function(){const s=parseInt($(this).val());console.log(s),$(game).css("zoom",s)}),$(game).on("click",d,function(){const s=$(this).attr("id"),t=parseInt(s.split("-")[0]),o=parseInt(s.split("-")[1]);I.blockClicked(t,o,`#${s}`)}),$(game).on("contextmenu",m,function(){const s=$(this).attr("id");I.flagField(`#${s}`)}),$(game).on("mousedown",d,function(){$(c).removeClass(A),$(c).addClass(F)})}}let G=0,U=0;class M{constructor(s){this.Game=s}startAI(){for(U=0,G=0,console.log("start AI");!this.Game.gameWon&&U<this.Game.rows*this.Game.columns;)0===points?this.clickAllBlocks():0===G?this.randomClick():(G=0,this.goThroughClicked()),U++}clickAllBlocks(){$(".field").each(function(){$(this).click()})}randomClick(){const s=[];$(".field").each(function(){s.push("#"+$(this).attr("id"))});const t=Math.floor(Math.random()*s.length),o=s[t];console.log("random click: ",o),$(o).click(),G++}goThroughClicked(){const s=this;$(".clicked").each(function(){const t=parseInt($(this).data("value"));if(t>0){const o=$(this).attr("id"),e=parseInt(o.split("-")[0]),i=parseInt(o.split("-")[1]),c=s.countUnclickedBlocksAround(e,i),l=s.countFlagsAround(e,i);c.length===t&&c.length>0?(flagArray(c),console.log("flag array:",c.length,t),G++):l===t&&0!==l&&clickBlocksAround(e,i)}})}countUnclickedBlocksAround(s,t){return this.checkClicked(s-1,t-1),this.checkClicked(s-1,t),this.checkClicked(s-1,t+1),this.checkClicked(s+1,t-1),this.checkClicked(s+1,t),this.checkClicked(s+1,t+1),this.checkClicked(s,t-1),this.checkClicked(s,t+1),[]}countFlagsAround(s,t){let o=0;return o=this.checkFlag(s-1,t-1,o),o=this.checkFlag(s-1,t,o),o=this.checkFlag(s-1,t+1,o),o=this.checkFlag(s+1,t-1,o),o=this.checkFlag(s+1,t,o),o=this.checkFlag(s+1,t+1,o),o=this.checkFlag(s,t-1,o),o=this.checkFlag(s,t+1,o)}checkClicked(s,t,o){const e=p(s,t);$(e).hasClass("tile")&&o.push(p(s,t))}checkFlag(s,t,o){const e=p(s,t);return $(e).hasClass("block")&&$(e).hasClass("flag")&&o++,o}flagArray(s){s.forEach(s=>{flag(s)})}flag(s){$(s).hasClass("flag")||flagField($(s))}clickBlock(s,t){const o=p(s,t);!$(o).hasClass("block")||$(o).hasClass("clicked")||$(o).hasClass("flag")||($(o).click(),console.log("click:",o),G++)}clickBlocksAround(s,t){clickBlock(s-1,t-1),clickBlock(s-1,t),clickBlock(s-1,t+1),clickBlock(s+1,t-1),clickBlock(s+1,t),clickBlock(s+1,t+1),clickBlock(s,t-1),clickBlock(s,t+1)}}o.d(t,"newGame",function(){return O});const N=!0;let P;function O(){if(void 0!==P)P.clearGame(),P.setupGame();else{P=new y(N),new T(P);const s=new M(P);$("#AI").click(function(){s.startAI()})}}$(document).ready(function(){O()}),$("#newgame-btn").click(function(){O()})}]);